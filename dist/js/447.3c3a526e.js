"use strict";(self["webpackChunktrekkingcastillayleon"]=self["webpackChunktrekkingcastillayleon"]||[]).push([[447],{8447:function(e,a,o){o.r(a),o.d(a,{default:function(){return j}});var t=o(6252),s=o(3577);const n=["src"],i=(0,t.Uk)("Mensaje");function r(e,a,o,r,c,l){const u=(0,t.up)("ion-back-button"),d=(0,t.up)("ion-buttons"),m=(0,t.up)("ion-toolbar"),g=(0,t.up)("ion-header"),h=(0,t.up)("ion-list-header"),f=(0,t.up)("ion-avatar"),j=(0,t.up)("ion-label"),p=(0,t.up)("ion-item"),M=(0,t.up)("ion-list"),U=(0,t.up)("ion-row"),w=(0,t.up)("ion-input"),b=(0,t.up)("ion-icon"),x=(0,t.up)("ion-col"),$=(0,t.up)("ion-grid"),I=(0,t.up)("ion-content"),_=(0,t.up)("ion-page");return(0,t.wg)(),(0,t.j4)(_,null,{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{slot:"start"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{defaultHref:"/tabs/tabMensajes"})])),_:1})])),_:1})])),_:1}),(0,t.Wm)(I,{fullscreen:!0},{default:(0,t.w5)((()=>[(0,t.Wm)($,{class:"grid"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{class:"columna"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{class:"fila"},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{class:"lista"},{default:(0,t.w5)((()=>[(0,t.Wm)(h,{class:"ionListHeader"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.zw)(e.nombreUsuarioMensaje),1)])),_:1}),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.mensajesMostrados,(a=>((0,t.wg)(),(0,t.j4)(p,{key:a.id,onClick:o=>e.opcionesMensaje(a.id,a.creador,a.mensaje)},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{slot:"start"},{default:(0,t.w5)((()=>[(0,t._)("img",{src:a.fotoPerfil},null,8,n)])),_:2},1024),(0,t.Wm)(j,null,{default:(0,t.w5)((()=>[(0,t._)("h3",null,(0,s.zw)(a.mensaje),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),(0,t.Wm)(U,{class:"fila"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{class:"mensaje"},{default:(0,t.w5)((()=>[(0,t.Wm)(j,{position:"floating"},{default:(0,t.w5)((()=>[i])),_:1}),(0,t.Wm)(w,{"clear-input":"",type:"text",modelValue:e.mensajeUsuario,"onUpdate:modelValue":a[0]||(a[0]=a=>e.mensajeUsuario=a)},null,8,["modelValue"]),(0,t.Wm)(b,{icon:e.arrowDownCircleOutline,slot:"end",onClick:a[1]||(a[1]=a=>e.anadirMensaje())},null,8,["icon"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var c=o(7330),l=o(8903),u=o(6216),d=o(2262);function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const a=16*Math.random()|0,o="x"==e?a:3&a|8;return o.toString(16)}))}var g=(0,t.aZ)({name:"TabMensajes",components:{IonHeader:c.Gu,IonToolbar:c.sr,IonContent:c.W2,IonPage:c._i,IonBackButton:c.oU,IonButtons:c.Sm,IonAvatar:c.BJ,IonLabel:c.Q$,IonItem:c.Ie,IonListHeader:c.yh,IonList:c.q_,IonInput:c.pK,IonGrid:c.jY,IonCol:c.wI,IonRow:c.Nd,IonIcon:c.gu},data(){return{mensajesMostrados:[]}},methods:{async presentActionSheetBorrar(e,a){const o=await c.BO.create({header:"Mensaje",buttons:[{text:"Borrar",role:"destructive",id:"delete-button",data:{type:"delete"},handler:()=>{console.log("Borrar mensaje clickado")}},{text:"Cancelar",handler:()=>{console.log("Cancelar clickado")}}]});await o.present();const{role:t}=await o.onDidDismiss();"destructive"==t&&(await u.db.collection("users").doc(u.I.currentUser.uid).collection("mensajes").doc(this.emailUsuario).collection("conversacion").get().then((a=>{a.forEach((async a=>{a.data().id==e&&(this.uidMensajeABorrar=a.id)}))})),await u.db.collection("users").doc(u.I.currentUser.uid).collection("mensajes").doc(this.emailUsuario).collection("conversacion").doc(this.uidMensajeABorrar).delete(),this.$router.go())},async presentActionSheetDenunciar(e){const a=await c.BO.create({header:"Mensaje",buttons:[{text:"Denunciar",role:"destructive",id:"delete-button",data:{type:"delete"},handler:()=>{console.log("Denunciar mensaje clickado")}},{text:"Cancelar",handler:()=>{console.log("Cancelar clickado")}}]});await a.present();const{role:o}=await a.onDidDismiss()}},setup(){const e=(0,d.qj)({imagenUsuarioMensaje:"",nombreUsuarioMensaje:"",emailUsuario:"",mensajeUsuario:"",fotoPerfilUsuario:"",emailUsuarioEmisor:"",uidUsuarioReceptor:"",uidMensajeABorrar:""});async function a(e,a,o){a==u.I.currentUser.displayName?this.presentActionSheetBorrar(e,o):this.presentActionSheetDenunciar()}async function o(){const e=new Date;var a,o,t,s,n,i;a=e.getHours()<10?"0"+e.getHours():e.getHours(),o=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),t=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds(),s=e.getDate()<10?"0"+e.getDate():e.getDate(),n=e.getMonth()<10?"0"+e.getMonth():e.getMonth(),i=e.getMilliseconds()<10?"00"+e.getMilliseconds():e.getMilliseconds()<100?"0"+e.getMilliseconds():e.getMilliseconds();const r=m(),c={id:r,creador:u.I.currentUser.displayName,mensaje:this.mensajeUsuario,fechaPublicacion:`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}`,fotoPerfil:this.fotoPerfilUsuario};this.mensajesMostrados.push(c),console.log(e),await u.db.collection("users").doc(u.I.currentUser?.uid).collection("mensajes").doc(this.emailUsuario).set({fechaPublicacion:`${e.getDate()}${e.getMonth()+1}${e.getFullYear()}${e.getHours()}${e.getMinutes()}${e.getSeconds()}${e.getMilliseconds()}`}),await u.db.collection("users").doc(u.I.currentUser?.uid).collection("mensajes").doc(this.emailUsuario).collection("conversacion").doc(s+n+e.getFullYear()+a+o+t+i).set({creador:u.I.currentUser.displayName,mensaje:this.mensajeUsuario,fechaPublicacion:`${e.getDate()}${e.getMonth()+1}${e.getFullYear()}${e.getHours()}${e.getMinutes()}${e.getSeconds()}${e.getMilliseconds()}`}),await u.db.collection("users").get().then((r=>{r.forEach((async r=>{r.data().email==this.emailUsuario&&(this.uidUsuarioReceptor=r.id,await u.db.collection("users").doc(this.uidUsuarioReceptor).collection("mensajes").doc(this.emailUsuarioEmisor).set({fechaPublicacion:`${e.getDate()}${e.getMonth()+1}${e.getFullYear()}${e.getHours()}${e.getMinutes()}${e.getSeconds()}${e.getMilliseconds()}`}),await u.db.collection("users").doc(this.uidUsuarioReceptor).collection("mensajes").doc(this.emailUsuarioEmisor).collection("conversacion").doc(s+n+e.getFullYear()+a+o+t+i).set({creador:u.I.currentUser.displayName,mensaje:this.mensajeUsuario,fechaPublicacion:`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}-${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}::${e.getMilliseconds()}`}),this.mensajeUsuario="")}))})),console.log("Mensaje enviado: "+c.mensaje)}async function t(){const a=await u.db.collection("users").doc(u.I.currentUser?.uid),o=await a.get();o.exists?(this.fotoPerfilUsuario=o.data().fotoPerfil,this.emailUsuarioEmisor=o.data().email):console.log("Error!"),await u.db.collection("users").get().then((a=>{a.forEach((a=>{a.data().email==this.emailUsuario&&(e.nombreUsuarioMensaje=a.data().nombre+" "+a.data().apellidos,e.imagenUsuarioMensaje=a.data().fotoPerfil,console.log(e.imagenUsuarioMensaje+" "+e.nombreUsuarioMensaje))}))})),await u.db.collection("users").doc(u.I.currentUser?.uid).collection("mensajes").doc(this.emailUsuario).collection("conversacion").get().then((e=>{e.forEach((e=>{var a;a=e.data().creador===u.I.currentUser?.displayName?{id:e.data().id,creador:e.data().creador,mensaje:e.data().mensaje,fechaPublicacion:e.data().fechaPublicacion,fotoPerfil:this.fotoPerfilUsuario}:{id:e.data().id,creador:e.data().creador,mensaje:e.data().mensaje,fechaPublicacion:e.data().fechaPublicacion,fotoPerfil:this.imagenUsuarioMensaje},this.mensajesMostrados.push(a)}))}))}return{...(0,d.BK)(e),opcionesMensaje:a,anadirMensaje:o,cargarPaginaMensajes:t,arrowDownCircleOutline:l.BC_}},mounted(){this.mensajesMostrado=[],this.emailUsuario=this.$route.params.email,this.cargarPaginaMensajes()}}),h=o(3744);const f=(0,h.Z)(g,[["render",r],["__scopeId","data-v-d7db417c"]]);var j=f}}]);
//# sourceMappingURL=447.3c3a526e.js.map